# 数字图像处理第七次作业  
 * 姓名：王秦龙
 * 班级：自动化62
 * 学号：2160504048
 * 提交日期：2019/4/30

------

##摘要
&emsp;本次实验比较实现了两种边缘检测方法，同时在边缘检测的基础上利用哈夫变换实现了直线检测。

### 1.边缘检测
&emsp; 本次实验中采取了两种边缘检测方法：sobel算子和canny检测，对基本原理做如下简述：
&emsp;**Sobel算子边缘检测**  
&emsp;sobel算子是一种梯度算子，是对于一阶导数的近似实现，也应此，sobel算子是对应于特定方向的，在实现中，我们使用水平和垂直两个方向的sobel算子检测边缘（matlab中sobel边缘检测默认模式为两个方向），sobel模板各方向中心使用的权数大于两边权数使得其具有平滑图像的作用。算子模板如下图所示：  
![cmd-markdown](https://s2.ax1x.com/2019/04/28/EQd8M9.png)  
&emsp;sobel算子检测边缘是使用模板滤波实现的，所以图像对模板的响应会有差别，导致检测边缘有差异，边缘越水平或越垂直，响应就越大，对于一些倾斜的边缘，响应就会小于水平或垂直边缘。   

&emsp;**Canny算子边缘检测**    
&emsp;canny算子边缘检测基本步骤：  

 * 用一个高斯模板滤波器平滑输入图像。
 * 计算梯度幅值图像和角度图像。
 * 对梯度图像幅值应用非最大抑制。
 * 用双阈值处理和连接分析来检测并连接边缘。  

对于canny方法中区别于其他方法的几点进行说明： 

 * canny算法中将梯度方向定义为四种:水平、垂直、+45、-45,非最大抑制是在此基础之上实现的。
 * 非最大抑制是在每个像素最接近方向，和相邻像素的梯度幅值进行比较，抑制那些拥有较小的值像素。
 * canny中采用双阈值，在非最大抑制的基础上用两个阈值TH和TL将边缘分为强边缘和弱边缘，连接每个强边缘附近的有效弱边缘，形成最终结果。  

&emsp;**边缘检测实现中的问题**    
&emsp;在用MATLAB实现边缘检测时采用的是edge函数。在函数实现时需要设置sobel算子处理后的图像的阈值，以使处理后的一些响应较弱的边缘不显示出来；在canny算子实现中也需要设置区分强弱边缘的阈值TH和TL。为了保证两个实验结果比较有对比性，我们不人为设定sobel算子实现时的阈值（此种情况下，matlab会在实现时自动的设定某个阈值进行分割），并**将matlab自动设定的sobel算子阈值作为canny检测时的阈值TL**，**TH设定为TL的2.5倍.**
```matlab
[S_I,threshs]=edge(I,'sobel');
```  
```matlab
C_I=edge(I,'canny',[threshs,2.5*threshs]);
```     

### 2.霍夫变换直线检测   
  
&emsp;霍夫变换解决了连接一幅图像中位于同一直线上的点的问题。将x，y空间中的点映射到$\rho$,$\theta$参数空间中，满足$$x*cos\theta+y*sin\theta=\rho$$霍夫变换计算上将参数空间划分为累加单元（将$\rho$和$\theta$离散化），对xy平面中的每个非背景点，令$\theta$等于每个允许的细分值，同时使用上面所示方程解出x,y,$\theta$对应的$\rho$，将得到的$\rho$四舍五入到最接近的允许单元（即离散化的$\rho$值），这样对应每个$\theta$就能计算一个$\rho$，并将计算结果$\theta$，$\rho$对应的累加单元中的数值加一。遍历整个图像中的非背景点后，累加单元中的值代表了对应参数决定的直线上有几个非背景点，这样就可以选择出多个拟合较好的直线。  
&emsp;细分的数量决定了点共线的精度，参数$\theta$设置的范围将决定能检测到多大斜率的直线。

&emsp;**边缘检测及直线检测实现**  

```matlab
function [ S_I,C_I ] = detect(I)
%   灰度图像I边缘检测及相应直线检测结果，边缘检测采用sobel和canny两种，直线检测采用 哈夫
%   此处显示详细说明
subplot(131);imshow(I);title('原图')
[S_I,threshs]=edge(I,'sobel');
subplot(232);imshow(S_I);title('Sobel边缘检测');
%得到霍夫空间 
[H1,T1,R1] = hough(S_I,'Theta',-89.9:0.1:89.9); 
%求极值点
Peaks1=houghpeaks(H1,20); 
%得到线段信息 
lines1=houghlines(S_I,T1,R1,Peaks1);
subplot(233);
imshow(S_I);title('哈夫直线检测'); hold on
%绘制线段 
for k=1:length(lines1) 
 xy=[lines1(k).point1;
 lines1(k).point2]; 
 plot(xy(:,1),xy(:,2),'blue','LineWidth',0.5); 
end 
%canny中设弱边缘阈值TL和另外两个边缘检测阈值相同，强边缘阈值TH为弱边缘阈值2.5倍
C_I=edge(I,'canny',[threshs,2.5*threshs]);
subplot(235);imshow(C_I);title('Canny算子');
%得到霍夫空间 
[H2,T2,R2] = hough(C_I,'Theta',-89.9:0.1:89.9); 
%求极值点
Peaks2=houghpeaks(H2,20); 
%得到线段信息 
lines2=houghlines(C_I,T2,R2,Peaks2);
subplot(236);imshow(C_I);title('哈夫直线检测'); hold on
%绘制线段 
for k=1:length(lines2) 
 xy=[lines2(k).point1;
 lines2(k).point2]; 
 plot(xy(:,1),xy(:,2),'blue','LineWidth',0.5); 
end 
```     

&emsp;实验结果：   
![cmd-markdown](https://s2.ax1x.com/2019/04/29/E3jylt.png)   
    
![cmd-markdown](https://s2.ax1x.com/2019/04/29/E3j2m8.png)   

![cmd-markdown](https://s2.ax1x.com/2019/04/29/E3jR0S.png)   

![cmd-markdown](https://s2.ax1x.com/2019/04/29/E3jhkQ.png)  

![cmd-markdown](https://s2.ax1x.com/2019/04/29/E3jopn.png)   

![cmd-markdown](https://s2.ax1x.com/2019/04/29/E3jTlq.png) 


&emsp;**结果分析**  
&emsp;这里对于两个边缘检测算法进行比较分析，并结合上图对直线检测结果进行一定分析，具体参数分析放在后面单独列出。
**边缘检测结果分析：**

 * canny边缘有更好好的完整性和连通性，这从第五张图（五角大楼？）处理结果可以很明显的看出
 * sobel检测边缘时，梯度检测边缘固有的缺陷使得在最后阈值分割时很容易将一些响应较小的边缘，这类边缘包括一些倾斜边缘（这个可以使用倾斜梯度模板解决）和一些和背景像素十分接近的边缘，比较明显的就是第二幅图像（积木块）中右侧三角体的一条边缘，观察原图发现，此边缘属于倾斜边缘，且和背景像素值十分接近。canny边缘检测中并不存在这样的问题。
 * sobel检测中会对很多无关的边缘有响应，而canny方法中对无关特性的抑制较好。比较明显的是最后一幅图像（拿着弓箭的人）中的地面树叶部分。  

**直线检测结果分析：**
&emsp;从每幅结果图像中能看出，直线检测有比较理想的结果，有很多直线未标示和设置的参数有关，结果中只连接了部有更多非背景点的直线。同时我们能够看出，直线检测的结果很依赖边缘检测结果（如果是想连接出边缘的话）。从最后一幅结果图（拿弓箭的人）我们不难看到，由于sobel检测结果中有大量无关特性，导致直线检测中出现了非边缘的直线，很多叶子的检测点被连成一条直线。   

### 2.霍夫变换直线检测参数分析  
&emsp;调整直线检测中使用的hough函数的参数，**1.改变hough空间的细分程度**，**2.改变霍夫变换中参数$\theta$范围**。   
结果及相应参数如图：（图中显示了边缘检测结果和直线检测结果，以及在参数空间标出了具有更大累加值的点）

![cmd-markdown](https://s2.ax1x.com/2019/04/30/E8SXK1.png)

![cmd-markdown](https://s2.ax1x.com/2019/04/30/E8SzVK.png)

![cmd-markdown](https://s2.ax1x.com/2019/04/30/E8pDMR.png)

![cmd-markdown](https://s2.ax1x.com/2019/04/30/E8psqx.png)

**直线检测参数分析：**  

最上面的一幅作为参数较好的检测结果图像，参数$\theta$范围是（-89.9，89.9），以0.1细分。

 * 第二幅图修改参数$\theta$范围是（-89，89），对比地一幅图像明显看到，0.9的角度差异使得网格线中大部分水平线都没有检测出来。也就是说，参数$\theta$决定了可检测的直线角度范围。但是这也告诉我们，如果我们对于水平线不感兴趣时，这个角度范围设的比较小也能获得所需结果。
 * 第三幅图像中修改参数$\theta$范围是（-20，20），也就是说只能够检测出近乎垂直的直线，结果中看到也是如此，只是图中有很多干扰，导致连接了很多错误点。
 * 第四幅图像修改参数$\theta$，以10细分，发现也出现了大量错误，组要是细分程度太差，导致本身不在一条直线上的点都能增加某个细分上的累加值，出现错误的检测。

&emsp;**综上所述，我们在应用哈夫变换直线检测时候，如果允许，应该将角度范围调整到最大，并尽可能细分的程度。当然这是对于一幅图像的信息完全未知时的最佳方案。当我们拥有足够的先验信息时，或者我们只对一部分角度范围的直线感兴趣时，就可调整$\theta$到比较合适的位置以获取更高速效率。**
 

  ------

**附录**


[1]: [美]Rafael C. Gonzalez 数字图像处理[M].阮秋琪,阮宇智等译.北京:电子工业出版社，2017.5 
[2]: 张德丰等著 Matlab数字图像处理[M].北京：机械工业出版社，2012.1





